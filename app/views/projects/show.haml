- content_for :title, @project.name

%section.hero.is-primary#projects
  .hero-body
    .container
      .columns.is-vcentered
        .column.is-narrow
          .project-avatar
            = project_icon(@project)
        .column
          %h1.title.is-2
            = @project.name
            - if @project.completed?
              %b-tooltip{ 'label': 'Project Completed', 'position': 'is-top', 'type': 'is-info' }
                %span.icon.iconify{ 'data-icon': 'ion:checkmark-done-circle-sharp', 'data-inline': 'false' }
            - elsif @project.open?
              %b-tooltip{ 'label': 'Project is Receiving Applications', 'position': 'is-top', 'type': 'is-info' }
                %span.icon.iconify{ 'data-icon': 'ic:baseline-person-add', 'data-inline': 'false' }
            - if @project.visibility
              %b-tooltip{ 'label': 'Public Project', 'position': 'is-right', 'type': 'is-info' }
                %span.icon.iconify{ 'data-tooltip': 'Tooltip Text', 'data-icon': 'fa:unlock' }
            - else
              %b-tooltip{ 'label': 'Private Project', 'position': 'is-right', 'type': 'is-info' }
                %span.icon.iconify{ 'data-icon': 'fa:lock' }

          %p Owned by: #{@project.user.name}
        .column.is-narrow
          - unless !user_signed_in? || current_user.in_project?(@project)
            - if current_user.invites.where(project: @project, types: 'application').size.positive?
              - invite = current_user.invites.find_by(project: @project, types: 'application')
              = button_to 'Cancel Application', invite_path(invite), method: 'delete', remote: true, data: { confirm: 'Are you sure?' }, class: 'button is-danger is-pulled-right', form: { '@ajax:error': 'ajaxError' }
            - elsif current_user.invites.where(project: @project, types: 'invite').size.positive?
              .box
                %h1.subtitle.is-4.has-text-primary You are Invited
                - invite = current_user.invites.find_by(project: @project, types: 'invite')
                = link_to 'Accept Invite', accept_invites_path(user_id: current_user.id, project_id: @project.id), method: 'post', remote: true, data: { confirm: 'Are you sure?' }, class: 'button is-success', '@ajax:error': 'ajaxError'
                = link_to 'Decline Invite', invite_path(invite), method: 'delete', remote: true, data: { confirm: 'Are you sure?' }, class: 'button is-danger', '@ajax:error': 'ajaxError'
            - elsif current_user != @project.user && @project.applicable?
              = button_to 'Join', invites_path(user_id: current_user.email, project_id: @project.id, types: 'application'), method: 'post', remote: true, data: { confirm: 'Are you sure?' }, class: 'button is-success is-pulled-right', form: { '@ajax:error': 'ajaxError' }
%section
  %b-tabs{ 'destroy-on-hide': '', 'type': 'is-boxed', 'expanded': '', 'v-model': 'selected', '@change': "getId(#{@project.id})" }
    %b-tab-item
      %template{ 'slot': 'header' }
        %span.icon.iconify{ 'data-icon': 'whh:avataralt', 'data-inline': 'false' }
        Members
      = render partial: 'members'
    - if user_signed_in? && current_user.in_project?(@project)
      %b-tab-item
        %template{ 'slot': 'header' }
          %span.icon.iconify{ 'data-icon': 'fe:list-task', 'data-inline': 'false' }
          Tasks
          - if @project.tasks.size.positive?
            %b-tag{ 'rounded': '', 'v-if': 'applicationCount == -1' }
              %p= @project.tasks.size
          %b-tag{ 'v-if': 'taskCount > 0', 'rounded': '' }
            {{ taskCount }}
      %b-tab-item
        %template{ 'slot': 'header' }
          %span.icon.iconify{ 'data-icon': 'ant-design:team-outlined', 'data-inline': 'false' }
          Your Team
          -# %b-tag{ 'rounded': '' }
          -#   {{ teamCount }}
    - if user_signed_in? && (@project.user == current_user || current_user.admin?)
      %b-tab-item
        %template{ 'slot': 'header' }
          %span.icon.iconify{ 'data-icon': 'mdi:application-import', 'data-inline': 'false' }
          Applications
          - if @project.invites.size.positive?
            %b-tag{ 'rounded': '', 'v-if': 'applicationCount == -1' }
              %p= @project.invites.size
          %b-tag{ 'rounded': '', 'v-if': 'applicationCount > 0' }
            %p {{ applicationCount }}
        = render partial: 'applications'
      %b-tab-item{ 'label': 'Settings' }
        %template{ 'slot': 'header' }
          %span.icon.iconify{ 'data-icon': 'ic:baseline-settings', 'data-inline': 'false' }
          Settings
        = render partial: 'settings'

